{% load static %}
{% load extras %}


{% load fontawesome_5 %}

{% fontawesome_5_static %}



<html>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="{% static 'css/planttemplate.css' %}">
<head><title>Home Page</title></head>


<body>

<div class="maincontainer">

<div class="imagecontainer">
  <img src="/static/images/plant.png" class="img"/>
  <span class="caption">{{ plantinfo.nickname }}<a href="/myplants/{{ plantinfo.id }}/update" class="link"> {% fa5_icon 'pencil-alt' 'fas' %}</a></span>
</div>


<div class="tablecontainer">

<table class="table table-striped">
<tr>
  <th>Temperature</th>
  <th>Humidity</th>
  <th>DeviceId</th>
  <th>MeasurementTime</th>
  <th>ServerTime</th>
  <th>Soil moisture</th>
  <th>SystemId</th>
  <th>Luminosity</th>
</tr>

{% for datarow in plantdatas %}
<tr>
  <td>{{ datarow.Temperature }}</td>
  <td>{{ datarow.Humidity }}</td>
  <td>{{ datarow.DeviceId }}</td>
  <td>{{ datarow.MeasurementTime }}</td>
  <td>{{ datarow.ServerTime }}</td>
  <td>{{ datarow.SoilMoisture }}</td>
  <td>{{ datarow.SystemId }}</td>
  <td>{{ datarow.Luminosity }}</td>
</tr>
{% endfor %}


</table>

</div>



</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div id="soilmoisture_div"></div>

<div id="chart_div"></div>

</body>
</html>

<style>

table, th, td, h1 {
text-align: center;
}

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>






google.charts.load('current', {packages: ['corechart', 'line', 'controls']});
google.charts.load('visualization', '1', { packages: ['corechart', 'controls'] });

google.charts.setOnLoadCallback(drawTemperatures);
google.charts.setOnLoadCallback(drawSoilMoisture);


var moistures = [{% for datarow in plantdatas %} {{ datarow.SoilMoisture }},{% endfor %}]
var temperatures = [{% for datarow in plantdatas %} {{ datarow.Temperature }},{% endfor %}]

var dates = {{ dates|safe }}


$(document).ready(function () {
    $(window).resize(function(){
      drawTemperatures();
      drawSoilMoisture();
    });
});
  
      
      function drawSoilMoisture() {
        var data = new google.visualization.DataTable();
        data.addColumn('datetime', 'X');
        data.addColumn('number', 'Moisture');

        

        var combined = moistures.map(function(e, i) {
        return [new Date(dates[i]), e];
        });
  
        data.addRows(combined);

        
  
        var options = {
          curveType: 'function',
          
          hAxis: {
            title: 'Measurement point',
            format: 'HH:mm',
            
          },

          
          vAxis: {
            
            title: 'Moisture',
            
          },
          backgroundColor: '#f1f8e9'
        };
  
        var chart = new google.visualization.LineChart(document.getElementById('soilmoisture_div'));
        chart.draw(data, options);
      };

      function drawTemperatures() {
        var data = new google.visualization.DataTable();
        data.addColumn('datetime', 'X');
        data.addColumn('number', 'Temperature');

        console.log("test")

        var combined = temperatures.map(function(e, i) {
        return [new Date(dates[i]), e];
        });
  
        data.addRows(combined);

        
  
        var options = {
          curveType: 'function',
          
          


          hAxis: {
            title: 'Measurement point',
            format: 'HH:mm'
            
          },
          vAxis: {
            
            title: 'Temperature',
            
          },
          backgroundColor: '#f1f8e9'
        };
  
        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      };

      

      
      </script>
